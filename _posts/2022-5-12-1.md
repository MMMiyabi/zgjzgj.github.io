---
layout:     post
title:      "Generation and evaluation of synthetic patient data"
subtitle:   ""
date:       2022-5-12 11:14:00
author:     "zgj"
catalog: true
header-style: text
tags: 论文阅读
---

### Abstract

机器学习在数据充裕的情况下是能提供很多帮助的。

但疾病领域缺乏足够的数据使机器学习的应用受到了限制，但和其它一些领域不一样的情况时，疾病领域不是没有足够的数据，只是出于保护病人隐私的目的，这些数据不能被自由的使用。

所以，本文对研究合成数据方法的评估上有很特别的一点，就是充分考虑合成的数据是否会泄露真实数据的信息。

本文对合成数据方法的评估是权衡数据有效性和保护隐私性的。

本文研究的合成方法完全是数据驱动的，即从已有的真实数据中去生成虚拟的合成数据。

本文使用的评估标准，每个都会针对以下的一个方面进行评估：

- 个体样本层面的保真度
- 群体层面的保真度（特征的边际和联合分布）
- 隐私泄露

本文讨论的数据合成方法可分为三类：

- 插补：多重插值，线性回归
- 联合概率分布：贝叶斯网络，高斯过程
- 函数近似：DNN，GANs

Python软件包DataSynthesizer可用于合成数据的生成



### Method

下面对一些方法进行介绍，会阐明每个方法的优缺点

#### Sampling from independent marginals（从边际分布中取样）

优点：简单

缺点：不能捕捉变量间的关系

#### Bayesian network（贝叶斯网络）

概率图模型，从真实数据中学习出结构和变量间的依赖性，因此合成的数据是考虑了变量间关系的

优点：可以建模变量之间的因果关系

缺点：实践中对图形结构进行简化，可能无法建模高阶依赖关系

#### Mixture of product of multinomials（多项式乘积混合）

优点：灵活，易扩展到混合数据类型

缺点：高维时计算较慢

#### Categorical latent Gaussian process（分类的潜在高斯过程）

生成模型，将样本映射到低维空间，再映射为输出向量，并由softmax函数得到各类别的概率，从而实现分类

优点：由于有丰富的潜在非线性映射，可以表示非常复杂的全联合分布

缺点：推理过程也很复杂，生成样本的效果可能很差

#### GANs（生成式对抗网络）

优点：生成性的方法，不需要概率模型假设

缺点：调参难，训练难，不稳定，生成的样本质量差

#### 多重插值

从其它变量推测缺失（生成）变量，步骤如下：

1）定义变量的拓扑排序。
2）计算第一个变量的经验边际概率分布。
3）对于拓扑顺序中的每一个连续变量，学习一个概率模型，用于给定当前变量的条件概率分布，即p(xv|x:v)，这是通过将第v个变量作为独立变量回归到其所有先前的变量上完成的。

用于建模条件分布的方法，有线性模型，随机森林和神经网络

优点：计算速度快，连续值和离散值都适用

缺点：不能保证能模拟数据的联合分布；效果依赖于拓扑排序



### 评估指标

前文已经介绍过，本文用两个指标衡量生成数据的质量，一个是数据效用，即合成数据能多大程度上捕获真实数据中的信息；一个是隐私保护，即合成数据会多大程度的泄露真实数据的信息。从描述和后面的结果可以看出，这两个指标是相互制约的。

#### 数据效用指标

- KL散度

**独立**计算每个特征，真实数据与合成数据边际概率分布间的差异性，因此不衡量变量间的依赖性

注意该公式是定义在一个变量上的

散度越小，表明数据相似度越高

![](https://i.vgy.me/h4JABr.png)

- 成对相关系数偏差（PCD）

PCD衡量两个数据的皮尔逊相关系数矩阵之间的差异

PCD越小，说明线性相关方面越相似

![](https://i.vgy.me/tAMGUa.png)

- 对数聚类（log-cluster）

衡量两个数据潜在结构在聚类方面的相似性；

这个方法会将**两种数据集合并**，然后进行聚类，G是聚类数量，c是真实样本的比例

该值越小，相似性越高

![](https://i.vgy.me/GnUugI.png)

- 支持率（覆盖率）

衡量合成数据中的类别是否覆盖了真实数据中每个特征里的每个类别

该指标等于1表明完全覆盖

![](https://i.vgy.me/4R9FRl.png)

- 交叉分类

衡量合成数据是否捕捉到了真实数据中的统计依赖性

每次从**多个特征中选出一个**，用**部分真实数据**或者**部分合成数据**训练一个分类器，然后比较分类器在剩余的真实数据和剩余的合成数据上的测试结果（通过计算分类准确率的比值）

根据训练集的选择可以分为两种：

CrCl-RS用真实数据进行训练，适合评估真实数据的统计特性和合成数据的统计特性是否相似

CrCl-SR用合成数据进行训练，适合评估从合成数据上得到的结论能否应用于真实数据

![](https://i.vgy.me/oLZQ6q.png)

#### 信息泄露指标

可分为两大类：身份泄露和属性泄露

**身份泄露**是指攻击者能判断出一个人在保密数据集中，其信息被用于生成模型的训练

**属性泄露**是指攻击者能够通过合成数据的属性值正确猜测出保密数据中的真实值

身份泄露的衡量方法：

1. 首先确定一个距离 d（本文中是汉明距离）
2. 选择一组用于合成数据的真实数据集（训练集） r 和一组没有用于合成数据的真实数据集（测试集） r 
3. 计算每个真实样本与每个合成样本的距离
4. 如果某个真实样本与至少一个合成样本的距离 < d，就声称该真实样本存在于训练集中（阳性）
5. 会有四种可能的情况，最后用精确率和召回率衡量身份泄露的程度

属性泄露的衡量方法：

攻击者可以通过合成样本的已知属性找到其k个近邻，然后用投票法推测出该样本的未知属性

已知属性的数量、合成数据集的大小，k的数量会影响揭示未知属性的机会

本文研究不同参数选择，能揭示未知属性的概率

保护隐私的关键是确保合成数据不过度依赖任何一个人的信息来实现



### 实验设置

**使用的数据集**有两个（注意这里的大小是从特征维度和类别数量上说的）：

一个是小数据集，包含8个特征，类别等级低（即每个变量中的类别数不多，**最高14**）

一个是大数据集，包含大约40个特征，类别等级高（某些变量包含上百个类别，**最高257**）

![](https://i.vgy.me/ulmK9W.png)

![](https://i.vgy.me/7lcDVT.png)

**使用的生成方法**：独立边际分布（IM），贝叶斯网络（BN），混合多因式乘积（MPoM），潜在变量高斯过程（CLGP），生成对抗网络变种（MC-MedGAN），多重插值的几种方式（MICE-LR，MICE-DT）

CLGP，MC-MedGAN使用提出方法作者的代码，BN使用Python软件包，其它的则自己实现

>47. CLGP code. https://github.com/yaringal/CLGP. Accessed 12 Oct 2019. 
>48. MC-MedGAN code. https://github.com/rcamino/multi-categorical-gans. Accessed 12 Oct 2019. 
>49. pomegranate Python package. https://pomegranate.readthedocs.io/en/ latest/. Accessed 12 Oct 2019. 
>50. libpgm Python package. https://pythonhosted.org/libpgm/. Accessed 12 Oct 2019.

**使用的评价指标**：对数聚类 ，因为它是唯一衡量全部真实样本和全部合成样本分布相似性的指标，而不仅仅是边际分布或变量间的关系

对于有超参的方法（MPoM,CLGP,MC-MedGAN,MICE-DT），使用**网格搜索**选择使对数聚类指标最佳的参数，具体参数设置见原文



### 实验结果

对每个数据集，生成的样本数都等于真实的样本数，下面仅展示在BREAST数据集上的结果，因为结论可扩展到另外两个数据集

#### 小数据集上的结果

![](https://i.vgy.me/CKoV4M.png)

![](https://i.vgy.me/S62FTu.png)

![](https://i.vgy.me/NEF1oe.png)

![](https://i.vgy.me/gmg4f7.png)

![](https://i.vgy.me/Z70FhC.png)

#### 大数据集上的结果

![](https://i.vgy.me/ypvmZN.png)

MICE-DT在数据效用上明显优于其它模型，但也会暴露信息

MICE的拓扑顺序对结果有很大影响，先易后难生成的数据更好

CLGP的数据效用性能也很好

GAN显然无法提取统计信息

![](https://i.vgy.me/G0ONSP.png)

![](https://i.vgy.me/hxShBF.png)

![](https://i.vgy.me/krAU1M.png)

![](https://i.vgy.me/yYL3rX.png)

#### 合成样本数量大小的影响

![](https://i.vgy.me/McV8KV.png)

![](https://i.vgy.me/HxPlRD.png)

![](https://i.vgy.me/Oyj1ba.png)

![](https://i.vgy.me/UV6iZ4.png)

![](https://i.vgy.me/uVOahe.png)

![](https://i.vgy.me/1LvzY9.png)

#### Edit checks(专家规则)

合成数据（10000条）没能**完全**通过专业规则（1400条if-then-else规则）的比例

![](https://i.vgy.me/hWEVWD.png)



### 讨论和结论

大数据集（基于本文中的概念）由于特征多，类别多，比小集更难以学习和生成效用好的数据

从结果看，BN，MPoM，CLGP能捕捉到特征间的关系

本文比较认可MPom和CLGP的效果

MC-MedGAN在本文的实验中表现很差😂
