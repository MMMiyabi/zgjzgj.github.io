---
layout:     post
title:      "预测维氏硬度"
subtitle:   ""
date:       2022-01-09 20:43:00
author:     "zgj"
catalog: true
header-style: text
tags: 机器学习
---





## 实验数据说明

> \1. 实验流程：首先，将基体与增强体按照一定的成分比例进行热压，此过程中实验参数主要为热压温度及热压压力；然后，对样品进行热处理，热处理过程可分为固溶过程及时效过程，实验参数包括固溶温度、固溶时间、时效温度以及时效时间；最后，进行样品的力学性能测试或硬度测试，其中力学性能为主，主要考量指标为材料的抗拉强度以及延伸率。
>
> \2. 目前性能最佳的样品参数为：编号58
>
> 成分为84% Al91Zn5.2Mg2.3Cu1.5+1%Mg+14.5%SiCp+0.5%CNTs；
>
> 热压工艺为550℃，300MPa；
>
> 热处理工艺为470℃固溶40min，120℃时效15h；
>
> 抗拉强度均值为650.8MPa，延伸率均值为3.5。
>
> \3. 主要考量指标标注
>
> 抗拉强度：低：≤550MPa；中：550-600MPa；高：600-650MPa；优秀：≥650MPa；
>
> 延伸率：低：≤2%；中：2-3%；高：≥3%。



## 数据集

数据集是铝合金的热处理数据，特征主要是各成分质量分数和工艺参数，目标属性是**维氏硬度**。

原始的数据集有27条，11维。

| 基体 | Mg   | SiCp | CNTs | 热压温度 | 热压压力 | 固溶温度 | 固溶时间 | 时效温度 | 时效时间 | 维氏硬度     |
| ---- | ---- | ---- | ---- | -------- | -------- | -------- | -------- | -------- | -------- | ------------ |
| 100  | 0    | 0    | 0    | 550      | 300      | 460      | 50       | 120      | 24       | 176.80±0.99  |
| 85   | 0    | 15   | 0    | 550      | 300      | 460      | 50       | 120      | 24       | 196.18±8.29  |
| 85   | 0    | 14.5 | 0.5  | 550      | 300      | 460      | 50       | 120      | 24       | 185.83±6.07  |
| 85   | 0    | 14   | 1    | 550      | 300      | 460      | 50       | 120      | 24       | 170.55±7.34  |
| 100  | 0    | 0    | 0    | 550      | 300      | 465      | 50       | 120      | 24       | 176.17±1.21  |
| 85   | 0    | 15   | 0    | 550      | 300      | 465      | 50       | 120      | 24       | 197.23±9.91  |
| 85   | 0    | 14.5 | 0.5  | 550      | 300      | 465      | 50       | 120      | 24       | 182.57±9.91  |
| 85   | 0    | 14   | 1    | 550      | 300      | 465      | 50       | 120      | 24       | 178.02±6.29  |
| 100  | 0    | 0    | 0    | 550      | 300      | 470      | 30       | 120      | 24       | 176.62±4.56  |
| 85   | 0    | 15   | 0    | 550      | 300      | 470      | 30       | 120      | 24       | 200.17±8.03  |
| 85   | 0    | 14.5 | 0.5  | 550      | 300      | 470      | 30       | 120      | 24       | 188.49±11.59 |
| 85   | 0    | 14   | 1    | 550      | 300      | 470      | 30       | 120      | 24       | 186.03±6.35  |
| 100  | 0    | 0    | 0    | 550      | 300      | 470      | 40       | 120      | 24       | 176.95±1.75  |
| 85   | 0    | 15   | 0    | 550      | 300      | 470      | 40       | 120      | 24       | 201.21±8.91  |
| 85   | 0    | 14.5 | 0.5  | 550      | 300      | 470      | 40       | 120      | 24       | 191.13±7.17  |
| 85   | 0    | 14   | 1    | 550      | 300      | 470      | 40       | 120      | 24       | 180.93±5.97  |
| 100  | 0    | 0    | 0    | 550      | 300      | 470      | 50       | 120      | 24       | 175.41±0.92  |
| 85   | 0    | 15   | 0    | 550      | 300      | 470      | 50       | 120      | 24       | 197.17±9.75  |
| 85   | 0    | 14.5 | 0.5  | 550      | 300      | 470      | 50       | 120      | 24       | 189.11±4.91  |
| 85   | 0    | 14   | 1    | 550      | 300      | 470      | 50       | 120      | 24       | 183.5±7.28   |
| 100  | 0    | 0    | 0    | 550      | 300      | 470      | 60       | 120      | 24       | 179.19±1.29  |
| 85   | 0    | 15   | 0    | 550      | 300      | 470      | 60       | 120      | 24       | 190.99±6.28  |
| 85   | 0    | 14.5 | 0.5  | 550      | 300      | 470      | 60       | 120      | 24       | 185.78±5.35  |
| 85   | 0    | 14   | 1    | 550      | 300      | 470      | 60       | 120      | 24       | 180.19±8.17  |
| 100  | 0    | 0    | 0    | 550      | 300      | 475      | 60       | 120      | 24       | 173.62±6.04  |
| 85   | 0    | 15   | 0    | 550      | 300      | 475      | 60       | 120      | 24       | 163.93±9.19  |
| 85   | 0    | 14.5 | 0.5  | 550      | 300      | 475      | 60       | 120      | 24       | 165.52±15.71 |



## 数据预处理

原始数据集中，有一些特征的数值是不变，这些特征没有意义，应该予以删除。另外将目标属性转为浮点数。处理后的数据集条数不变，但维度减少到6维。

| 基体 | SiCp | CNTs | 固溶温度 | 固溶时间 | 维氏硬度 |
| ---- | ---- | ---- | -------- | -------- | -------- |
| 100  | 0    | 0    | 460      | 50       | 176.8    |
| 85   | 15   | 0    | 460      | 50       | 196.18   |
| 85   | 14.5 | 0.5  | 460      | 50       | 185.83   |
| 85   | 14   | 1    | 460      | 50       | 170.55   |
| 100  | 0    | 0    | 465      | 50       | 176.17   |
| 85   | 15   | 0    | 465      | 50       | 197.23   |
| 85   | 14.5 | 0.5  | 465      | 50       | 182.57   |
| 85   | 14   | 1    | 465      | 50       | 178.02   |
| 100  | 0    | 0    | 470      | 30       | 176.62   |
| 85   | 15   | 0    | 470      | 30       | 200.17   |
| 85   | 14.5 | 0.5  | 470      | 30       | 188.49   |
| 85   | 14   | 1    | 470      | 30       | 186.03   |
| 100  | 0    | 0    | 470      | 40       | 176.95   |
| 85   | 15   | 0    | 470      | 40       | 201.21   |
| 85   | 14.5 | 0.5  | 470      | 40       | 191.13   |
| 85   | 14   | 1    | 470      | 40       | 180.93   |
| 100  | 0    | 0    | 470      | 50       | 175.41   |
| 85   | 15   | 0    | 470      | 50       | 197.17   |
| 85   | 14.5 | 0.5  | 470      | 50       | 189.11   |
| 85   | 14   | 1    | 470      | 50       | 183.5    |
| 100  | 0    | 0    | 470      | 60       | 179.19   |
| 85   | 15   | 0    | 470      | 60       | 190.99   |
| 85   | 14.5 | 0.5  | 470      | 60       | 185.78   |
| 85   | 14   | 1    | 470      | 60       | 180.19   |
| 100  | 0    | 0    | 475      | 60       | 173.62   |
| 85   | 15   | 0    | 475      | 60       | 163.93   |
| 85   | 14.5 | 0.5  | 475      | 60       | 165.52   |

在这里，由于可观察到的数据的特殊性，并不急着对数据进行归一化或标准化处理，在后面实验时，根据选择的具体模型，再决定是否进行归一化或标准化处理。



## 模型选择

本文选择的模型有：

- svr（‘linear','rbf'）

`svm.SVR( kernel=linear/rbf, degree=3, gamma='scale', coef0=0.0, tol=0.001, C=1.0, epsilon=0.1, shrinking=True, cache_size=200, verbose=False, max_iter=-1)`

- 决策树

`tree.DecisionTreeRegressor(max_depth=2)`

- 随机深林

`RandomForestRegressor(n_estimators=100,max_depth=2)`

- lasso

`linear_model.Lasso(alpha=0.2)`

- 内核岭回归

`KernelRidge(alpha=0.2)`

- k近邻

`KNeighborsRegressor(n_neighbors = 3)`



## 数据扩增

由于数据集的样本量比较少，在实验过程中，用自助法进行了数据扩增，具体操作是：

1. 每次从数据集中随机抽取n条样本
2. 计算这n条样本的每个维度的均值
3. 一次计算结果为扩增的一条样本
4. 根据需要扩增的数量重复m次

本文中对数据分别扩增了10条，27条（原始数据集的条目数），100条



## 实验结果

下面的每个实验，如果没有特别说明，都是将总的数据集以7:3的比例分为训练集和测试集，并且对于训练集，进行5折交叉验证，每个实验会列出不同模型的验证结果和预测结果。

### 原始数据结果

|            | cv-mae  | predict-mae |
| ---------- | ------- | ----------- |
| svr-linear | 8.7     | 4           |
| svr-rbf    | 11.3    | 6.8         |
| tree       | 7.5     | 4.4         |
| **rf**     | **5.7** | **3.3**     |
| lasso      | 8.7     | 5.1         |
| krr        | 8.4     | 5           |
| knn        | 7.5     | 8.3         |

### 扩增数据的结果

**10条扩增数据**

|            | cv-mae | predict-mae |
| ---------- | ------ | ----------- |
| svr-linear | 0.86   | 1.68        |
| svr-rbf    | 1.58   | 3.59        |
| tree       | 1.1    | 1.6         |
| rf         | 1.29   | 1.87        |
| lasso      | 1.1    | 1.7         |
| krr        | 0.85   | 2.22        |
| knn        | 1.64   | 2.67        |

**27条扩增数据**

|            | cv-mae | predict-mae |
| ---------- | ------ | ----------- |
| svr-linear | 2.83   | 3.1         |
| svr-rbf    | 2.71   | 1.9         |
| tree       | 3.3    | 1.8         |
| rf         | 2.7    | 1.46        |
| lasso      | 2.43   | 2.35        |
| krr        | 2.3    | 1.82        |
| knn        | 2.66   | 1.8         |

**100条扩增数据**

|            | cv-mae | predict-mae |
| ---------- | ------ | ----------- |
| svr-linear | 1.45   | 1.51        |
| svr-rbf    | 2.11   | 2.2         |
| tree       | 1.72   | 1.96        |
| rf         | 1.64   | 1.71        |
| lasso      | 1.54   | 1.62        |
| krr        | 1.5    | 1.34        |
| knn        | 1.74   | 1.95        |

扩增数据集数量很少时，比如10条和27条时，模型训练的结果很不稳定，并且有时会表现出很明显的过拟合，但扩增数据集的数量增加到100时，模型预测的结果比较稳定，也没有明显的过拟合，但此时数据集的特性似乎已经与原始数据集有了相当大的变化。

*展示10条扩增数据*

| 基体 | SiCp  | CNTs | 固溶温度 | 固溶时间 | 维氏硬度 |
| ---- | ----- | ---- | -------- | -------- | -------- |
| 88   | 11.5  | 0.5  | 469      | 47       | 180.225  |
| 86.5 | 13.2  | 0.3  | 467.5    | 46       | 185.413  |
| 85   | 14.6  | 0.4  | 468.5    | 51       | 184.392  |
| 88   | 11.5  | 0.5  | 468      | 50       | 180.452  |
| 88   | 11.5  | 0.5  | 469      | 48       | 181.316  |
| 91   | 8.65  | 0.35 | 469      | 47       | 179.623  |
| 88   | 11.55 | 0.45 | 468      | 47       | 181.336  |
| 86.5 | 13.1  | 0.4  | 467.5    | 50       | 183.795  |
| 88   | 11.65 | 0.35 | 468.5    | 47       | 184.636  |
| 89.5 | 10    | 0.5  | 469      | 49       | 179.395  |

### 扩增数据集作为训练集，真实数据作为测试集

将上述的三种不同数量的扩增数据集分别作为训练集，并进行5折交叉验证，将原始数据集作为测试集进行实验。每个实验列出不同模型的实验结果

**10条扩增数据**

![](https://i.vgy.me/TIRvXP.png)

**27条扩增数据**

![](https://i.vgy.me/gaSPcw.png)

**100条扩增数据**

![](https://i.vgy.me/x1HbpC.png)

可以看到模型表现出极大的过拟合，对于所有的模型，没有一个结果能比只用原始数据集进行实验好

### 在训练集中混合扩增数据，测试集为真实数据

先将原始数据按7:3的比例分为训练集和测试集，在训练集中混入扩增的样本，对训练集进行5折交叉验证，每个实验列出不同模型的验证结果和预测结果。

**10条**

|            | cv-mae   | predict-mae |
| ---------- | -------- | ----------- |
| svr-linear | 5.9      | 5.4         |
| svr-rbf    | 7.45     | 4.49        |
| tree       | 4.85     | 4.6         |
| **rf**     | **4.21** | **2.66**    |
| lasso      | 5.34     | 6.47        |
| krr        | 5.2      | 6.56        |
| knn        | 6.2      | 4.62        |

**27条**

|            | cv-mae   | predict-mae |
| ---------- | -------- | ----------- |
| svr-linear | 3.85     | 7.45        |
| svr-rbf    | 5.29     | 5.31        |
| tree       | 4.32     | 5.2         |
| **rf**     | **3.61** | **4.11**    |
| lasso      | 3.38     | 8.49        |
| krr        | 3.34     | 8.38        |
| knn        | 4.2      | 8.26        |

**100条**

|            | cv-mae | predict-mae |
| ---------- | ------ | ----------- |
| svr-linear | 2.2    | 5.82        |
| svr-rbf    | 3.25   | 5.74        |
| **tree**   | **3**  | **4.17**    |
| rf         | 2.72   | 5           |
| lasso      | 2.34   | 7.56        |
| krr        | 2.21   | 8.22        |
| knn        | 2.72   | 8.37        |

## 结论

通过在训练集中混入扩增数据，可能使实验结果变好（rf模型），但要注意到由于本实验数据集样本量极少，实验结果带有随机性，而本文的所有数据都是**一次实验的结果**，因此后续还要做一些工作，比如将~~一次实验的结果~~变为多次实验结果的平均值，这样产生的结论更有说服力。
